#今天终于实验室服务器外网可以连接了，也算是我本科毕业前高端玩一回了。以下将记录我的服务器linux-centos系统之旅
#我本人电脑是双系统，win10+linux-ubuntu16.04LTS
#linuxPC终端用ssh访问无服务器
sudo apt-get install ssh
ssh xiongdongyan@202.118.163.236
#进入服务器当然首先是配置软件，由于我不是root用户，配软件很吃力。
#1.第一次在服务器上发现conda自动下载所有rstudio所需包了，却运行不了。以后一定要搞明白，浪费很多时间在conda上
我自己创建了以下文件夹
mkdir src #用于存放下载软件
mkdir biosoft#用于存放使用软件
mkdir sra-data#存放毕业论文数据及练习数据
#sratoolkit安装
安装方法和RNAseq软件安装一样，只是centos和ubuntu不是一个版本，在NCBI下载
wget https://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/2.8.2-1/sratoolkit.2.8.2-1-centos_linux64.tar.gz #后续方法参考我写的RNAseq软件安装

从Ｒ的官网下载了最新的3.4.3的Ｒ
tar -zxvf R包的名字
cd ~/scr/R-3.4.3
./configure --prefix=/home/xiongdongyan/src/R-3.4.3 --enable-R-shlib --with-blas --with-lapack
＃报错
 1.configure: error: No F77 compiler found
#解决方法　yum install gcc-gfortran
２.configure: error: --with-readline=yes (default) and headers/libs are not available
#解决方法 yum install  readline-devel
3.configure: error: --with-x=yes (default) and X11 headers/libs are not available
#解决方法 yum install libXt-devel
4.configure: error: C++ preprocessor "/lib/cpp" fails sanity check
#解决方法 yum install gcc-c++  glibc-headers
５.configure: error: zlib library and headers are required
#解决方法 cd ~/src
wget http://zlib.net/zlib-1.2.11.tar.gz
tar -zxvf zlib-1.2.11.tar.gz && cd zlib-1.2.11 && make && make install && cd .. && rm -rf zlib-1.2.11
都解决好后，　make && make install
#yum 不是ubuntu的包管理器，ubuntu要单独安装，但是不要用装太多东西。
#因为自己笔记本误删Ｒ后一直装不好，旧版本装上是错误无options函数，应该是文件有错误，今天顺便在自己笔记本上把root权限给设置了，ubuntu一般是不给root权限的
sudo passwd
输入新UNIX密码
重新输入新UNIX密码
su root
输入密码即可成功
#今天在自己ubuntu系统yum装东西的时候，报错
E: 无法获得锁 /var/lib/dpkg/lock – open (11: 资源暂时不可用)
E: 无法锁定管理目录(/var/lib/dpkg/)，是否有其他进程正占用它？
我查阅资料找到了解决方法
１．ps -aux ，列出进程。找到含有apt‘-get的进程，直接sudo kill PID。解决
2.sudo rm /var/cache/apt/archives/lock
  sudo rm /var/lib/dpkg/lock #强制解锁
   再次install软件，若提示：E: dpkg 被中断
  sudo dpkg --configure -a　#解决

#在sratoolkit软件配置好后开始下载大豆转录组数据。
＃在/home/xiongdongyan/sra-data/下
mkdir 练习
cd /练习/
#在NCBI官网上的SRA数据库中检索soybean&senescence
找到BioProject:PRJNA262564　SRA Study:SRP048326
选择SRR1592294到SRR1592309数据，批量下载
for i in `seq 294 309`
do
prefetch -c SRR1592${i}
done
转换为fastq格式
for i in `seq 294 309`
do
fastq-dump --gzip --split-3 -O /home/xiongdongyan/sra-data/练习 -A SRR1592${i}
done

#2017.12.04 今天做质控
cd ~/sra-data/练习
mkdir 初次质控
for i in `seq 294 309`
do
fastqc SRR1592{i}_1.fastq.gz SRR1592{i}_2.fastq.gz -O ~/sra-data/练习/初次质控
done

#2017.12.05开始过滤fastq数据
#做过滤需要下载trimmomatic软件，登录服务器
cd ~/src
wget https://www.usadellab.org/cms/uploads/supplementary/Trimmomatic/Trimmomatic-0.36.zip
unzip Trimmomatic-0.36.zip
cd ~/sra-data
mkdir 过滤后数据
cd ~/sra-data/练习
for i in `seq 294 309`
do
java -jar ~/src/Trimmomatic-0.36/trimmomatic-0.36.jar PE -threads 4 -phred33 -trimlog 
SRR1592${i}_1.fastq.gz SRR1592${i}_2.fastq.gz SRR1592${i}_1_paired.fastq.gz SRR1592${i}_1_unpaired.fastq.gz
SRR1592${i}_2_paired.fastq.gz SRR1592${i}_2_unpaired.fastq.gz ILLUMINACLIP:~/src/Trimmomatic-0.36/adapters/
TruSeq3-PE.fa:2:30:10:1:true LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:51
done
#这些参数设置我是阅读了相关资料，http://www.biotrainee.com/thread-1484-1-1.html
首先关于phred分数是选33还是64
1. 如果有2个以上的质量字符ASCII值小于等于58(即有两个碱基的得分小于等于25），同时没有任何质量字符的ASCII值大于等于75，即判断是Phred+33。
2. 如果有2个以上的质量字符ASCII值大于等于75(即有两个碱基的得分大于等于10），同时没有任何质量字符的ASCII值小于等于58，即判断是Phred+64。
3. 如果所有质量字符的ASCII值介于59到74之间，即判断可能是Phred+33，但建议使用更多的序列做进一步测试（出现这种结果可能有两种情况：1, Phred+33编码，所有碱基质量得分介于26到42之间；2，Phred+64编码，所有碱基质量得分介于-5到10；是前者的可能性大）。
4. 如果出现上述3种以外的情况，建议打印出质量字符的ASCII值人工判断。
第二个是keepBothReads：只对 PE 测序的 palindrome clip 模式有效，这个参数很重要，在上图中 D 模式下， 
R1 和 R2 在去除了接头序列之后剩余的部分是完全反向互补的，默认参数 false，意味着整条去除与 R1 完全反向互补的 R2，当做重复去除掉，但在有些情况下，
例如需要用到 paired reads 的 bowtie2 流程，就要将这个参数改为 true，否则会损失一部分 paired reads。
seedMismatches：指定第一步 seed 搜索时允许的错配碱基个数，例如 2。
palindrome clip threshold：指定针对 PE 的 palindrome clip 模式下，需要 R1 和 R2 之间至少多少比对分值（上图中 D 模式），才会进行接头切除，例如 30。
simple clip threshold：指定切除接头序列的最低比对分值（上图 A/B 模式），通常 7-15 之间。
minAdapterLength：只对 PE 测序的 palindrome clip 模式有效，指定 palindrome 模式下可以切除的接头序列最短长度，由于历史的原因，默认值是 8，但实际上 palindrome 模式可以切除短至 1bp 的接头污染，所以可以设置为 1 
LEADING
从 reads 的起始端开始切除质量值低于设定的阈值的碱基，直到有一个碱基其质量值达到阈值。
LEADING:<quality>
quality:设定碱基质量值阈值，低于这个阈值将被切除。
TRAILING
从 reads 的末端开始切除质量值低于设定阈值的碱基，直到有一个碱基质量值达到阈值。
Illumina 平台有些低质量的碱基质量值被标记为 2 ，所以设置为 3 可以过滤掉这部分低质量碱基。
官方推荐使用 Sliding Window 和 MaxInfo 来代替 LEADING 和 TAILING。

#过滤完后 
mv *paired.fastq.gz *unpaired.fastq.gz *.log ~/sra-data/过滤后数据
cd ~/sra-data/过滤后数据
mkdir 过滤后质控
for i in `seq 294 309`
do
fastqc SRR1592${i}_1_paired.fastq.gz SRR1592${i}_2_paired.fastq.gz -O ~/sra-data/过滤后数据/过滤后质控
done

